### Description of the databases [here](<../Week_01/movie_pc_ships.pdf/>)

### Scripts of the databases [here](<../Week_01/Scripts/>)

# Упражнение 4 - Външни съединения

Нека разгледаме таблиците Customer и Order

| customerID | companyName |
|------------|-------------|
| 123        |      A      |
| 567        |      B      |
|    987     |      C      |

| orderID    | customerID  |
|------------|-------------|
|    1       |      123    |
|   2        |      567    |

### Inner join

Вече разгледахме `inner join` в предишно упражнение и знаем, че 
резултатната таблица ще съдържа *само клиентите, които са правили поръчки*

При:
```sql
SELECT *
FROM CUSTOMER C INNER JOIN ORDER O
      ON C.customerID = O.customerID
```

Таблицата ще изглежда така:

| customerID | companyName | orderID | customerID |
|------------|-------------|---------|------------|
| 123        |      A      | 1       | 123        |
| 567        |      B      | 2       | 567        |

### Left join (right join)

При заявка:
```sql
SELECT *
FROM CUSTOMER C LEFT JOIN ORDER O
      ON C.customerID = O.customerID
```
Таблицата ще има вида:

| customerID | companyName | orderID | customerID |
|------------|-------------|---------|------------|
| 123        |      A      | 1       | 123        |
| 567        |      B      | 2       | 567        |
| 987        |      C      | null    | null       |

Тоест `left join` включва всички редове от лявата таблица, като за тези, които не изпълняват условието в ON клаузата, ще зададе стойности null в колоните от дясната таблица.

Аналогично е и с `right join` (включват се всички редове от дясната таблица).

### Примерни случаи

Нека разгледаме таблиците t1 и t2

| a | b | 
|---|---|
| 1 | 10|
| 2 | 11|
| 3 | 12|
| 4 | 12|

| c |
|---|
| 1 |
| 3 |
| 5 |

- ```sql
  SELECT *
  FROM t1 JOIN t2
        ON a = c
  ```
  | a | b | c |
  |---|---|---|
  | 1 | 10| 1 |
  | 3 | 12| 3 |

- ```sql
  SELECT *
  FROM t1 LEFT JOIN t2
      ON a = c
  ```
    | a | b | c  |
    |---|---|----|
    | 1 | 10| 1  |
    | 2 | 11|null|
    | 3 | 12| 3  |
    | 4 | 12|null|

- ```sql
    SELECT *
    FROM t1 FULL JOIN t2
        ON a = c
  ```
    | a  | b  | c  |
    |----|----|----|
    | 1  | 10 | 1  |
    | 2  | 11 |null|
    | 3  | 12 | 3  |
    | 4  | 12 |null|
    |null|null| 5  |

  При `full join` се добавят всички редове от лявата и всички от дясната. И за двете се прилага условието в ON за определяне на null стойности.

- ```sql
  SELECT *
  FROM t1 JOIN t2
      ON a = c
  WHERE c = 1
  ```
  | a | b | c |
  |---|---|---|
  | 1 | 10| 1 |

- ```sql
  SELECT *
  FROM t1 JOIN t2
      ON a = c AND c = 1
  ```
  | a | b | c |
  |---|---|---|
  | 1 | 10| 1 |

- ```sql
  SELECT *
  FROM t1 LEFT JOIN t2
      ON a = c
  WHERE c = 1
  ```
  | a | b | c |
  |---|---|---|
  | 1 | 10| 1 |

  Тук първо се сформира таблицата по ON условието за left join и после се филтрира чрез условието в WHERE

- ```sql
    SELECT *
    FROM t1 LEFT JOIN t2
        ON a = c AND c = 1
    ```
    | a | b | c  |
    |---|---|----|
    | 1 | 10| 1  |
    | 2 | 11|null|
    | 3 | 12|null|
    | 4 | 12|null|

    Тук условието в ON филтрира къде ще имаме null стойности. На трети ред например (условието а = с е изпълнено) имаме null, тъй като c = 3 не успява да се свърже по условието на left => е висящ кортеж, допълва се с null.

    **Хубаво е да разделяваме ON от WHERE клаузата**

- ```sql
  SELECT *
  FROM t1 LEFT JOIN t2
      ON a > c AND b = 12
  ```
    | a | b | c  |
    |---|---|----|
    | 1 | 10|null|
    | 2 | 11|null|
    | 3 | 12| 1  |
    | 4 | 12| 1  |
    | 4 | 12| 3  |

  Тук можем да го мислим като: Всяко а се сравнява с всяко с, за да се определи първото условие (където висящ е само първият кортеж; задължително се добавя всеки кортеж от лявата таблица, а ако един се свърже по условие с няколко кортежа в дясната таблица се добавят всички съвпадения). После се сравняват стойностите в b, за да се определят допълнителните висящи кортежи (които отговарят на първото, но не и на второто условие).

- ```sql
  SELECT *
  FROM t1 LEFT JOIN t2
      ON a > c OR b = 12
  ```
    | a | b | c  |
    |---|---|----|
    | 1 | 10|null|
    | 2 | 11| 1  |
    | 3 | 12| 1  |
    | 4 | 12| 1  |
    | 4 | 12| 3  |
    | 3 | 12| 3  |
    | 3 | 12| 5  |
    | 4 | 12| 5  |

  Последните 3 реда са резултати само от b = 12
